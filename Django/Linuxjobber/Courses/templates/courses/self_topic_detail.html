{% extends 'courses/self_base.html' %}

{% block topic_head %}
    <span class="small">
    {{ active_topic.data }}
    </span>
     /
    {{ course.data }}
{% endblock %}

{% block beadcrumb_left %}
    {% if course %}
    <a style="color: rgba(255, 255, 255, 0.5);" href="{% url 'Courses:topics' course.data.course_title.split|join:'_' %}" class="navbar-item no-pad-right no-margin-right text-alt-2">
        <span class="small"> {{ course.data|capfirst }} / </span>
    </a>
    {% endif %}

{% endblock %}

{% block beadcrumb_right %}

    <a class="navbar-item no-pad-left no-margin-left" >
        <span class="size-18"> &nbsp;{{ active_topic.data }}</span>
    </a>
{% endblock %}


{% block title %}
    {{ active_topic.data }}: {{ course.data }}
{% endblock %}

{% load staticfiles %}
{% block content %}
    <style>

    .no-pad-left{
        padding-left: 0;
    }
    .no-pad-right{
        padding-right: 0;
    }
    .no-margin-left{
        margin-left: 0;
    }
    .no-margin-right{
        margin-right: 0;
    }
    .text-alt-2{
        color: rgba(255, 255, 255, 0.5);
    }

.side-bar {
height: 100%;
width: 370px;
position: fixed;
z-index: 1;
top: 0;
right: 0;
overflow: hidden;
padding-top: 70px;
}

.top {
color: #ffffff;
background-color:  rgba(0, 0, 0, 0.8);
height: 67px;
width: 100%;
border-radius: 0px 0px 0px 10px;
padding:  20px 40px 20px 20px;
overflow: hidden;
display: block;
}

.text-alt{
color: rgba(255, 255, 255, 0.5);
}
.size-11{
    font-size: 11px;
}

    progress{
        position: relative;
        bottom: unset;
        height: 3px;
    }


    .padding-top-10{
        padding-top: 5px;
    }
    .mid {
color: #ffffff;
background-color:  rgba(0, 0, 0, 0.8);
height: 115px;
width: 100%;
border-radius: 10px 0px 0px 10px;
margin-top: 5px;
padding:  20px 40px 20px 20px;
display: block;
}
.course-outline {
color: #ffffff;
background-color:  rgba(0, 0, 0, 0.8);
display: block;
  height: 100%;
  overflow: hidden;
width: 100%;
border-radius: 10px 0px 0px 10px;
margin-top: 5px;
padding:  0px 20px 50px 20px;
}

p.actions{
    margin-top: 8px;

}
p.margin-top-10{
    margin-top: 6px;
}
.actions .button{
    border: none;
    margin-right: 40px;
    background: rgba(255, 255, 255, 0.05);
    color: #ffffff;
}

.course-outline .topic-container{
    height: 90%;
    width: 100%;
    padding-left: 11px;
   padding-top: 10px;
    padding-bottom: 100px;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: thin;

}

#topic-container::-webkit-scrollbar {
    width: 5px;
    background-color: rgba(255, 255, 255, 0.05);
}
::-webkit-scrollbar-thumb {
    background-color:#E5E5E5
}


.course-outline ul{
    padding: 0;
    margin: 0;
}
.course-outline li {
    list-style: none;
  border-color: rgba(255, 255, 255, 0.5) !important;
  margin:0; padding: 2px 23px 10px;
  position: relative;
  border-left: 2px solid  rgba(255, 255, 255, 0.5);
  margin-right: 10px;
  padding-right: 0;
    height: 100%;
  width:100%;
  font-size: 12px;
  display:inline-block;


}



.course-outline li:before {
  content: '';
  right: 100%;
  margin-right: -9px;
  position: absolute;
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.5);
  border-radius: 50%;
  padding: 10px;
  height: 18px;
  width: 18px;

  text-align:center;
  color: white;
  font-size: 11px;
  background-color: #2e2e2e;
}
.course-outline li.completed::before{
    box-shadow: 0 0 0 2px #6AC259;
    background-image: url({% static 'Courses/images/checked.png' %});

}
.course-outline li.played::before{
    box-shadow: 0 0 0 2px #6AC259;
    content: '';
}

.course-outline li:first-child{

}
.course-outline li:first-child:before{
}
.course-outline li:last-child:before{
  margin-right:-11px;
}
.course-outline li:first-child {
  border-top: 0;
}

.course-outline li:last-child {
  border:none;
}

li > a {
    color: rgba(255, 255, 255, 0.5);
}
li :hover {
    color: #000;

}


.span-section{
    margin-top: 8px;
    margin-left: -10px;
    display: inline-block;
    margin-bottom: 13px;


}


.topic-content{
    margin-right: 275px;
    border: 2px  solid green;
    width: 100%;
    height:100%;
    overflow: hidden;
    padding: 22px 100px 10px 10px;


}

.topic-content > .topic-container{

    height: 90%;
    width: 100%;
    padding-top: 22px;
    padding-bottom: 10px;


}
.is-centered{
    width: 200px;
margin:auto;
}

.note-container{
       margin-top: 45px;
    width: 100%;
    height:auto;
}

.video-container {
    margin-top: 20px;
    width: 100%;
    height:auto;
}
.video-description{
    padding-top: 22px;
}

    #nav-button .button{
        font-size: 14px;
        width: 100px;
height: 38px;
color: white;
        font-weight: 600;

background: rgba(0, 0, 0, 0.8);
box-shadow: 0 0 4px rgba(0, 0, 0, 0.25);
border-radius: 19px 5px 5px 19px;

    }
    #nav-button  .button.right{
        width: 100px;
height: 38px;
color: white;
        font-weight: 600;
        padding-right: 10px;
        padding-left: 30px;
background: rgba(0, 0, 0, 0.8);
box-shadow: 0 0 4px rgba(0, 0, 0, 0.25);
border-radius: 5px 19px 19px 5px;
    }


strong{
    font-weight: 500;
}
</style>

<div class="topic-content">

    <div class="topic-container">
<div class="container">
    <div id="nav-button" class="level is-mobile" style="width: 100%;">
        <div class="level-left" >
            <a href="" class="button"> <span class="icon"><img src="{% static 'Courses/images/navarrow.png' %}"/></span> <span> Previous</span></a>
        </div>
        <div class="level-item"> <span class="size-18"><strong>{{ active_topic.data }}</strong> </span> </div>
        <div class="level-right">
            <a href="" class="button right">
                <span> Next </span>
                <span class="icon"><img style="transform: rotate(180deg)" src="{% static 'Courses/images/navarrow.png' %}"/></span>
            </a>

        </div>
    </div>
</div>
        <div id="video">
            <div class="video-container">
                <video src="{{ active_topic.data.video }}" controls width="100%" height='100%' id="myVideo"></video>
        </div>
        <div class="video-description">
            <p class="size-14">Description</p>
            <p class="size-18"> {{ active_topic.data.description }} </p>
        </div>
        </div>

        <div id="notes">
            <div class="note-container">

                <p class="size-18">
                    <strong>
                        {{ active_topic.data }}
                    </strong>

                </p>

                <div class="note-content">
                    {{ active_topic.note.Detail|safe }}
                </div>

            </div>


        </div>

    </div>
</div>


<div class="side-bar">
    <div class="top">
        <p class="size-12"> Total Course Progress &nbsp; &nbsp; <span class="text-alt size-11">{{ active_topic.completion }}%</span> </p>
        <p class="padding-top-10">

            <progress class="progress {% if active_topic.completion > 0 %} is-success {% endif %}" value="{{ active_topic.completion }}" max="100">
                {% if active_topic.completion > 0 %}{{ active_topic.completion }}%
                {% else %} Indeterminate {% endif %}
            </progress>
        </p>
    </div>
    <div class="mid">
        <p class="size-12 text-alt">
            Course &bullet;
            <span class="size-11"> {{ active_topic.data.pk }}/{{ topics|length }} </span>
        </p>
        <p class="size-14 margin-top-10">{{ active_topic.data }}</p>
        <p class="actions">
            <a id="toggleNote" {% if not active_topic.data.has_notes %} disabled {% endif %}  class="button"><span class="icon"><img src="{% static 'Courses/images/glasses-white.png' %}" alt=""></span> &nbsp; <span> Read Notes</span> </a>
            <a href="{% url 'Courses:labs' course.data.course_title.split|join:'_' active_topic.data.topic_number %}" {% if not active_topic.data.has_labs %} disabled {% endif %}  class="button"><span class="icon"><img src="{% static 'Courses/images/contract-white.png' %}" alt=""></span>&nbsp; <span>Practice Labs</span>  </a>
        </p>

    </div>

    <div class="course-outline">
        {% regroup topics by section as topic_list %}
        <div class="topic-container text-alt size-12" id="topic-container">
            {% for section, topics in topic_list %}
            <span class="span-section">{% if section %} {{ section }} {% else %} Topics {% endif %} </span>
                <ul>
                {% for topic in topics %}
                    {#                  Give access to Admin Instructor (Role 1 - Role 3) , Subscribers (Role 6), Single Access (Role 4 with permission)#}
{#                    Or Topic is free #}
                      {% if permission.permission == 1 or request.user.role >= 1 and request.user.role <= 3 or topic.data.free %}
                <li class="{% if topic.completion > 0 and topic.completion < 100 %}played{% else %}completed{% endif %} ">
                    <a href="{% url 'Courses:topic_details' course_slug topic.data.topic_number %}">{{ topic.data }}</a>
                </li>
                          {% else %}
                          <li class="{% if topic.completion > 0 and topic.completion < 100 %}played{% else %}completed{% endif %} ">
                    <a >{{ topic.data }} <span style="float: right;"><img src="{% static 'Courses/images/no-access.png' %}" alt=""></span></a>
                </li>

                  {% endif %}
                {% endfor %}
                </ul>
            {% endfor %}

        </div>

    </div>
</div>



{% endblock %}



{% block extra_scripts %}
    <script>
    var note_trigger = $('#toggleNote');
    var video_container = $('#video');
    var notes_container = $('#notes');

          $(document).ready(function(){
              notes_container.hide();
              note_trigger.click(function () {
                  video_container.hide();
                  notes_container.show()
              });


               end(0);

 $('#myVideo').bind("ended", function(){
 	$('.videoname').hide();
 	$('.aftervideo').show();
 	$('.lab').show();
 	end(1);
 });

function end(stat){
	if (stat == 1){
		$.ajax({
		type: 'POST',
		data:'',
		url: '{% url "Courses:videostat" active_topic.data.id 1 %}',
		success: function (result) {
			setTimeout(function(){  },1000);
		}
	});
	}else{
		$.ajax({
		type: 'POST',
		data:'',
		url: '{% url "Courses:videostat" active_topic.data.id 0 %}',
		success: function (result) {
			setTimeout(function(){  },1000);
		}
	});
	}
}

          });
    {#Trigger Video play status #}



    </script>
{% endblock %}